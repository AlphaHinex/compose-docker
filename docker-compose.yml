redis:
  image: redis:5.0.6
  volumes:
    - ./redis/data:/data
    - ./redis/redis.conf:/usr/local/etc/redis/redis.conf
  command: redis-server /usr/local/etc/redis/redis.conf --appendonly yes
  ports:
    - "6379:6379"

mysql:
  image: mysql:5.7.28
  volumes:
    - ./mysql/data:/var/lib/mysql
    - ./mysql/conf:/etc/mysql/conf.d
  environment:
    - MYSQL_ROOT_PASSWORD=3426
    - MYSQL_DATABASE=ah
    - MYSQL_USER=ah
    - MYSQL_PASSWORD=ah
  ports:
    - "3306:3306"

teamcity-server:
  image: jetbrains/teamcity-server:2019.1.5
  links:
    - mysql
  volumes:
    - ./teamcity/server/data:/data/teamcity_server/datadir
    - ./teamcity/server/logs:/opt/teamcity/logs
    - ./teamcity/server/entrypoint.sh:/entrypoint.sh
  environment:
    # Modify as will
    - TEAMCITY_CONTEXT=teamcity
    - TEAMCITY_DATA_PATH=/data/teamcity_server/datadir
    - TEAMCITY_SERVER_MEM_OPTS=-Xmx2g -XX:MaxPermSize=270m -XX:ReservedCodeCacheSize=350m
  entrypoint: /entrypoint.sh
  ports:
    - "8111:8111"

teamcity-agent:
  image: jetbrains/teamcity-agent:2019.1.5
  links:
    - redis
    - teamcity-server
  environment:
    - SERVER_URL=http://teamcity-server:8111

jenkins:
  image: alphahinex/compose-docker:jenkins-lts
  ports:
    - "8080:8080"
    - "50000:50000"

nexus:
  image: sonatype/nexus3
  volumes:
    - ./nexus/data:/nexus-data
  ports:
    - "8081:8081"
